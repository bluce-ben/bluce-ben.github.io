---
title: 认识与学习BASH之数据流重导向
date: 2017-12-28 19:11:09
categories:
- 书籍
- 《鸟哥的Linux私房菜基础篇（第三版）》
tags:
- 书籍
- BASH
- shell
---
数据流重导向就是将某个指令执行后应该要出现在屏幕上的数据，给他传输到其他的地方，例如档案或者是装置(例如打印机之类的)。

### 1、什么是数据流导向？
这得要由指令的执行结果谈起。一般来说，如果你要执行一个指令，通常他会是这样的：
![](/uploads/2017/12/linux_standard_input_output_error.JPG)
<!--more-->
我们执行一个指令的时候，这个指令可能会由档案读入资料，经过处理之后，再将数据输出到屏幕上。在上图当中，standard output 与 standard error output 分别代表【标准输出】与【标准错误输出】，这两个默认都是输出到屏幕上面。那么什么是标准输出与标准错误输出呢？

### 2、standard output 与 standard error output
简单的说，标准输出指的是【指令执行所回传的正确的讯息】，而标准错误输出可理解为【指令执行失败后，所回传的错误讯息】。不管正确或错误的数据都是默认输出到屏幕上，所以屏幕当然是乱的。那能不能透过某些机制将这两股数据分开呢？答案是可以的。那就是数据流重导向的功能，数据流重导向可以将 standard output(简称 stdout) 与 standard error output (简称 stderr)分别传送到其他的档案或装置去，而分别传送所用的特殊字符则如下所示：

	1. 标准输入 (stdin) ：代码为 0 ，使用 < 或 << ；
	2. 标准输出 (stdout)：代码为 1 ，使用 > 或 >> ；
	3. 标准错误输出(stderr)：代码为 2 ，使用 2> 或 2>> ；
**（注：一个'<'符号表示覆盖，两个'<<'表示追加。）**

#### 对于输入重定向来讲，用到的符号及其作用如下表：
<style type="text/css">
	table th:first-of-type {
		width: 25%;
	}
</style>

符号					| 作用
------------------------|-----------------------------
命令 < 文件				| 将文件作为命令的标准输入
命令 << 分界符			| 从标准输入中读入，直到遇见分界符才停止
命令 < 文件1 > 文件2	| 将文件1作为命令的标准输入并将标准输出到文件2

#### 对于输出重定向来讲，用到的符号及其作用如下表：

符号					| 作用
------------------------|---------------------------
命令 > 文件				| 将标准输出重定向到一个文件中（清空原有文件的数据）
命令 2> 文件			| 将错误输出重定向到一个文件中（清空原有文件的数据）
命令 >> 文件			| 将标准输出重定向到一个文件中（追加到原有内容的后面）
命令 2>> 文件			| 将错误输出重定向到一个文件中（追加到原有内容的后面）
命令 >> 文件 2>&1<br/>或<br/>命令 &>> 文件  | 将标准输出与错误输出共同写入到文件中（追加到原有内容的后面）


### 3、/dev/null 垃圾桶黑洞装置与特殊写法
如果我知道错误讯息会发生，所以要将错误讯息忽略掉而不显示或储存，这个时候黑洞装置 /dev/null 就很重要了。这个 /dev/null 可以吃掉任何导向这个装置的信息。
```
示例：
[dmtsai@www ~]$ find /home -name .bashrc 2> /dev/null
/home/dmtsai/.bashrc <==只有 stdout 会显示到屏幕上， stderr 被丢弃了
```
如果我要将正确与错误数据通通写入同一个档案去，这个时候就得要使用特殊的写法了。我们同样用底下的案例来说明：
```
示例：将指令的数据全部写入名为 list 的档案中
[dmtsai@www ~]$ find /home -name .bashrc > list 2> list <==错误
[dmtsai@www ~]$ find /home -name .bashrc > list 2>&1 <==正确
[dmtsai@www ~]$ find /home -name .bashrc &> list <==正确
```
上述表格第一行错误的原因是，由于两股数据同时写入一个档案，又没有使用特殊的语法，此时两股数据可能会交叉写入该档案内，造成次序的错乱。所以虽然最终 list 档案还是会产生，但是里面的数据排列是乱的，而不是原本屏幕上的输出排序。至于写入同一个档案的特殊语法如上所示，你可以使用 2>&1 也可以使用 &> 。一般来说，比较常见的是 2>&1 的语法。