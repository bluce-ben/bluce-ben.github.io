---
title: 基础网络概念（一）
date: 2018-01-10 18:34:11
categories:
- 书籍
- 《鸟哥的Linux私房菜服务器架设篇（第三版）》
tags:
- 书籍
- 计算机网络
---
### 1、计算机网络组成组件
我们以底下这张联机示意图来解释好了：
![](/uploads/2018/01/network_component.JPG)
<!--more-->
在上图中，我们主要需要注意到的硬件有哪些呢？大致有底下这些啦：
* **节点 (node)：**节点主要是具有网络地址 (IP) 的设备之称，因此上面图示中的一般PC、Linux 服务器、ADSL 调制解调器与网络打印机等，个别都可以称为一个 node！那中间那个集线器 (hub) 是不是节点呢？因为他不具有 IP ，因此 hub 不是节点。
* **服务器主机 (server)：**就网络联机的方向来说，提供数据以【响应】给用户的主机，都可以被称为是一部服务器。举例来说，Yahoo 是个 WWW 服务器，昆山的 FTP (http://ftp.ksu.edu.tw/) 是个文件服务器等等。
* **工作站 (workstation) 或客户端 (client)：**任何可以在计算机网络输入的设备都可以是工作站，若以联机发起的方向来说，主动发起联机去【要求】数据的，就可以称为是客户端 (client)。举例来说，一般 PC 打开浏览器对 Yahoo 要求新闻数据，那一般 PC 就是客户端。
* **网络卡 (Network Interface Card, NIC)：**内建或者是外插在主机上面的一个设备，主要提供网络联机的卡片，目前大都使用具有 RJ-45 接头的以太网络卡。一般 node 上都具有一个以上的网络卡，以达成网络联机的功能。
* **网络接口：**利用软件设计出来的网络接口，主要在提供网络地址 (IP) 的任务。一张网卡至少可以搭配一个以上的网络接口；而每部主机内部其实也都拥有一个内部的网络接口，那就是 loopback (lo) 这个循环测试接口！
* **网络形态或拓朴 (topology)：**各个节点在网络上面的链接方式，一般讲的是物理连接方式。举例来说，上图中显示的是一种被称为星形联机 (star) 的方式，主要是透过一个中间连接设备，以放射状的方式连接各个节点的一种形态，这就是一种拓朴。
* **网关 (route) 或通讯闸 (gateway)：**具有两个以上的网络接口，可以连接两个以上不同的网段的设备，例如 IP 分享器就是一个常见的网关设备。那上面的 ADSL 调制解调器算不算网关呢？其实不太能算，因为调制解调器通常视为一个在主机内的网卡设备，我们可以在一般 PC 上面透过拨号软件， 将调制解调器仿真成为一张实体网卡 (ppp) ，因此他不太能算是网关设备！

网络设备其实非常多也非常复杂，不过如果以小型企业角度来看，我们能够了解上述图示内各设备的角色，那应该也足够了！接下来，让我们继续来讨论一下网络范围的大小吧！

### 2、计算机网络区域范围
由于各个节点的距离不同，联机的线材与方式也有所差异，由于线材的差异也导致网络速度的不同，让网络的应用方向也不一样。 根据这些差异，早期我们习惯将网络的大小范围定义如下：
>1. 局域网络 (Local Area Network, LAN)：
节点之间的传输距离较近，例如一栋大楼内，或一个学校的校区内。可以使用较为昂贵的联机材料， 例如光纤或是高质量网络线 (CAT 6) 等。网络速度较快，联机质量较佳且可靠，因此可应用于科学运算的丛集式系统、 分布式系统、云端负荷分担系统等。
>2. 广域网 (Wide Area Network, WAN)：
传输距离较远，例如城市与城市之间的距离，因此使用的联机媒体需要较为便宜的设备，例如经常使用的电话线就是一例。 由于线材质量较差，因此网络速度较慢且可靠性较低一些，网络应用方面大多为类似 email, FTP, WWW 浏览等功能。

除了这两个之外，还有所谓的都会网络 (Metropolitan Area Network, MAN)，不过近来比较少提及，因此你只要知道有 LAN 及 WAN 即可。这两个名词在很多地方你都可以看的到。改天你回家看看你家的 ADSL 调制解调器或 IP 分享器后面的插孔看看，你就能够看到有 WAN 与 LAN 的插孔，现在你就知道为啥有这两个灯号与插孔了吧。

### 3、计算机网络协议： OSI 七层协定
我们可以将整个网络连接过程分成数个阶层 (layer)，每个阶层都有特别的独立的功能，而且每个阶层的程序代码可以独立撰写，因为每个阶层之间的功能并不会互相干扰的。 如此一来，当某个小环节出现问题时，只要将该层级的程序代码重新撰写即可。所以程序撰写也容易，整个网络概念也就更清晰！ 那就是目前你常听到的 OSI 七层协议 (Open System Interconnection) 的概念。
依据定义来说，越接近硬件的阶层为底层 (layer 1)，越接近应用程序的则是高层 (layer 7) 。不论是接收端还是发送端，每个一阶层只认识对方的同一阶层数据。

![](/uploads/2018/01/network_osi_01.JPG)
上图中仔细看每个数据报的部分，上层的包裹是放入下层的数据中，而数据前面则是这个数据的表头。其中比较特殊的是第二层，因为第二层 (数据链结层) 主要是位于软件封包 (packet) 以及硬件讯框 (frame) 中间的一个阶层，他必须要将软件包装的包裹放入到硬件能够处理的包裹中，因此这个阶层又分为两个子层在处理相对应的数据。因为比较特殊，所以第二层的数据格式比较不一样，尾端还出现一个检查码.
简单的说，每一层负责的任务如下：
<style type="text/css">
table th:first-of-type {
	width: 150px;
}
</style>

分层		|	负责任务
------------|-----------------------------------------------------------
Layer 1<br/>物理层<br/>Physical Layer 	|	由于网络媒体只能传送 0 与 1 这种位串，因此物理层必须定义所使用的媒体设备之电压与讯号等， 同时还必须了解数据讯框转成位串的编码方式，最后连接实体媒体并传送/接收位串。
Layer 2<br/>数据链结层<br/>Data-Link Layer 	|	这一层是比较特殊的一个阶层，因为底下是实体的定义，而上层则是软件封装的定义。因此第二层又分两个子层在进行数据的转换动作。 在偏硬件媒体部分，主要负责的是 MAC(Media Access Control) ，我们称这个数据报裹为 MAC 讯框 (frame)， MAC 是网络媒体所能处理的主要数据报裹，这也是最终被物理层编码成位串的数据。MAC 必须要经由通讯协议来取得媒体的使用权， 目前最常使用的则是 IEEE802.3 的以太网络协议。详细的 MAC 与以太网络请参考下节说明。<br/>至于偏向软件的部分则是由逻辑链接层 (logical linkcontrol, LLC) 所控制，主要在多任务处理来自上层的封包数据 (packet) 并转成 MAC 的格式， 负责的工作包括讯息交换、流量控制、失误问题的处理等等。
Layer 3<br/>网络层<br/>Network Layer 	|	这一层是我们最感兴趣的啰，因为我们提及的 IP (Internet Protocol) 就是在这一层定义的。 同时也定义出计算机之间的联机建立、终止与维持等，数据封包的传输路径选择等等，因此这个层级当中最重要的除了 IP 之外，就是封包能否到达目的地的路由 (route) 概念了！
Layer 4<br/>传送层<br/>Transport Layer 	|	这一个分层定义了发送端与接收端的联机技术(如 TCP, UDP技术)， 同时包括该技术的封包格式，数据封包的传送、流程的控制、传输过程的侦测检查与复原重新传送等等， 以确保各个资料封包可以正确无误的到达目的端。
Layer 5<br/>会谈层<br/>Session Layer 	|	在这个层级当中主要定义了两个地址之间的联机信道之连接与挂断，此外，亦可建立应用程序之对谈、 提供其他加强型服务如网络管理、签到签退、对谈之控制等等。如果说传送层是在判断资料封包是否可以正确的到达目标， 那么会谈层则是在确定网络服务建立联机的确认。
Layer 6<br/>表现层<br/>Presentation Layer| 		我们在应用程序上面所制作出来的数据格式不一定符合网络传输的标准编码格式的！ 所以，在这个层级当中，主要的动作就是：将来自本地端应用程序的数据格式转换(或者是重新编码)成为网络的标准格式， 然后再交给底下传送层等的协议来进行处理。所以，在这个层级上面主要定义的是网络服务(或程序)之间的数据格式的转换， 包括数据的加解密也是在这个分层上面处理。
Layer 7<br/>应用层<br/>Application Layer |	应用层本身并不属于应用程序所有，而是在定义应用程序如何进入此层的沟通接口，以将数据接收或传送给应用程序，最终展示给用户。

事实上，OSI 七层协议只是一个参考的模型 (model)，目前的网络社会并没有什么很知名的操作系统在使用 OSI 七层协议的联网程序代码。那...讲这么多干嘛？这是因为 OSI 所定义出来的七层协议在解释网络传输的情况来说，可以解释的非常棒，因此大家都拿 OSI 七层协议来做为网络的教学与概念的理解。至于实际的联网程序代码，那就交给 TCP/IP 了！

### 4、计算机网络协议： TCP/IP
虽然 OSI 七层协议的架构非常严谨，是学习网络的好材料。但是也就是因为太过严谨了，因此程序撰写相当不容易，所以造成它在发展上面些许的困扰。而由 ARPANET 发展而来的 TCP/IP 又如何呢？其实 TCP/IP 也是使用 OSI 七层协议的观念，所以同样具有分层的架构，只是将它简化为四层，在结构上面比较没有这么严谨，程序撰写会比较容易些。后来在 1990 年代由于 email, WWW 的流行，造成 TCP/IP 这个标准为大家所接受，这也造就目前我们的网络社会！

既然 TCP/IP 是由 OSI 七层协议简化而来，那么这两者之间有没有什么相关性呢？它们的相关性可以图示如下， 同时这里也列出目前在这架构底下常见的通讯协议、封包格式与相关标准：
![](/uploads/2018/01/network_osi_tcpip.JPG)

从上图中，我们可以发现 TCP/IP 将应用、表现、会谈三层整合成一个应用层，在应用层上面可以实作的程序协议有 HTTP, SMTP, DNS 等等。 传送层则没有变，不过依据传送的可靠性又将封包格式分为连接导向的 TCP 及非连接导向的 UDP 封包格式。网络层也没有变，主要内容是提供了 IP 封包，并可选择最佳路由来到达目标 IP 地址。数据链结层与物理层则整合成为一个链结层，包括定义硬件讯号、 讯框转位串的编码等等，因此主要与硬件 (不论是区网还是广域网) 有关。

那 TCP/IP 是如何运作的呢？我们就拿妳常常连上的 Yahoo 入口网站来做个说明好了，整个联机的状态可以这样看：
>1.应用程序阶段：妳打开浏览器，在浏览器上面输入网址列，按下 [Enter]。此时网址列与相关数据会被浏览器包成一个数据， 并向下传给 TCP/IP 的应用层；
>2.应用层：由应用层提供的 HTTP 通讯协议，将来自浏览器的数据报起来，并给予一个应用层表头，再向传送层丢去；
>3.传送层：由于 HTTP 为可靠联机，因此将该数据丢入 TCP 封包内，并给予一个 TCP 封包的表头，向网络层丢去；
>4.网络层：将 TCP 包裹包进 IP 封包内，再给予一个 IP 表头 (主要就是来源与目标的 IP)，向链结层丢去；
>5.链结层：如果使用以太网络时，此时 IP 会依据 CSMA/CD 的标准，包裹到MAC 讯框中，并给予 MAC 表头，再转成位串后， 利用传输媒体传送到远程主机上。

等到 Yahoo 收到你的包裹后，在依据相反方向拆解开来，然后交给对应的层级进行分析，最后就让 Yahoo 的 WWW 服务器软件得到你所想要的数据，该服务器软件再根据你的要求，取得正确的资料后，又依循上述的流程，一层一层的包装起来， 最后传送到你的手上！就是这样！

根据这样的流程，我们就得要知道每个分层所需要了解的基础知识，这样才算学习网络基础.所以下面一节我们会依据 TCP/IP 的链结层、网络层、传送层来进行说明，应用层的协议则在以后对应的协定再来谈！

### 5、Linux 网络相关配置文件案
我们知道 TCP/IP 的重要参数主要是： IP, Netmask, Gateway, DNS IP ，而且千万不要忘记你这部主机也应该要有主机名 (hostname)！此外，我们也知道 IP 的取得有手动设定、DHCP 处理等。那么这些参数主要是写在哪些配置文件？如何对应呢？底下就让我们来处理一番！

所需网络参数    |    主要配置文件档名    |    重要参数
----------------|------------------------|------------------------------
IP、Netmask、DHCP 与 Gateway 等<br/>  |  /etc/sysconfig/network-scripts/ifcfg-eth0  |   DEVICE=网卡的代号<br/>BOOTPROTO=是否使用 dhcp<br/>HWADDR=是否加入网卡卡号(MAC)<br/>IPADDR=就是IP 地址<br/>NETMASK=指网络屏蔽<br/>ONBOOT=要不要默认启动此接口<br/>GATEWAY=就是通讯闸<br/>NM_CONTROLLED=额外的网管软件
主机名          |   /etc/sysconfig/network  |   NETWORKING=要不要有网络<br/>NETWORKING_IPV6=支援IPv6 否？<br/>HOSTNAME=你的主机名
DNS IP          |   /etc/resolv.conf        |   nameserver DNS 的IP
私有IP对应的主机名 |    /etc/hosts          |   私有IP 主机名 别名