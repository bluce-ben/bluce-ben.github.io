---
title: Linux之用户身份与权限
date: 2018-10-12 12:23:54
categories:
- 书籍
- 《Linux就该这么学》
tags:
- Linux
- 书籍
---
在RHEL 7系统中，用户身份有下面这些：
* 管理员UID为0：系统的管理员用户。
* 系统用户UID为1~999：Linux系统为了避免因某个服务程序出现漏洞而被黑客提权至整台服务器，默认服务程序会有独立的系统用户负责运行，进而有效控制被破坏范围。
* 普通用户UID从1000开始：是由管理员创建的用于日常工作的用户。

Linux系统中创建每个用户时，将自动创建一个与其同名的基本用户组，而且这个基本用户组只有该用户一个人。
如果该用户以后被归纳入其他用户组，则这个其他用户组称之为扩展用户组。
（注：一个用户只有一个基本用户组，但是可以有多个扩展用户组。）
<!--more-->

#### 一、常用命令
##### 1、useradd 命令
用于创建新的用户，格式为“useradd [选项] 用户名”。
**useradd 命令中的用户参数以及作用**
<style>
table th:first-of-type {
	width: 20%;
}
</style>

参数	|	作用
--------|-----------------
-d		| 指定用户的家目录（默认为/home/username）
-e		| 账户的到期时间，格式为YYYY-MM-DD
-u 		| 指定改用户的默认UID
-g		| 指定一个初始的用户基本组（必须已存在）
-G		| 指定一个或多个扩展用户组
-N		| 不创建与用户同名的基本用户组
-s		| 指定该用户的默认Shell解释器

##### 2、groupadd 命令
用于创建用户组，格式为“groupadd [选项] 群组名”。

##### 3、usermod 命令
用于修改用户的属性，格式为“usermod [选项] 用户名”。
**usermod 命令中的参数及作用**

参数	|	作用
--------|-----------------
-c		| 填写用户账户的备注信息
-d -m	| 参数-m 与参数-d 连用，可重新指定用户的家目录并自动把旧的数据转移过去
-e		| 账户的到期时间，格式为 YYYY-MM-DD
-g		| 变更所属用户组
-G		| 变更扩展用户组
-L		| 锁定用户禁止其登录系统
-U		| 解锁用户，允许其登录系统
-s		| 变更默认终端
-u		| 修改用户的 UID

##### 4、passwd 命令
用于修改用户密码、过期时间、认证信息等，格式为“passwd [选项] [用户名]”。
**passwd 命令中的参数以及作用**

参数	|	作用
--------|-----------------
-l		| 锁定用户，禁止其登录
-u		| 解除锁定，允许用户登录
--stdin	| 允许通过标准输入修改用户密码，如 echo "NewPassWord" &#124; passwd --stdin Username
-d		| 使该用户可用空密码登录系统
-e		| 强制用户在下次登录时修改密码
-S		| 显示用户的密码是否被锁定，以及密码所采用的加密算法名称

##### 5、userdel 命令
用于删除用户，格式为“userdel [选项] 用户名”。
**userdel 命令的参数以及作用**

参数	|	作用
--------|-----------------
-f		| 强制删除用户
-r		| 同时删除用户及用户家目录


#### 二、文件权限与归属
Linux系统中一切都是文件。文件的类型不尽相同，因此Linux系统使用了不同的字符来加以区分，常见的字符如下所示：
* -: 普通文件
* d: 目录文件
* l: 链接文件
* b: 块设备文件
* c: 字符设备文件
* p: 管道文件

在 Linux 系统中，每个文件都有所属的所有者和所有组，并且规定了文件的所有者、所有组以及其他人对文件所拥有的可读（r）、可写（w）、可执行（x）等权限。
对于一般文件来说，权限比较容易理解：“可读”表示能够读取文件的实际内容；“可写”表示能够编辑、新增、修改、删除文件的实际内容；“可执行”则表示能够运行一个脚本程序。
对目录文件来说，“可读”表示能够读取目录内的文件列表；“可写”表示能够在目录内新增、删除、重命名文件；而“可执行”则表示能够进入该目录。


#### 三、文件的特殊权限
##### 1、SUID（待补充）

##### 2、SGID（待补充）

##### 3、SBIT
SBIT 特殊权限位可确保用户只能删除自己的文件，而不能删除其他用户的文件。

##### 4、文件的隐藏属性
###### （1）chattr 命令
用于设置文件的隐藏权限，格式为“chattr [参数] 文件”。
如果想要把某个隐藏功能添加到文件上，则需要在命令后面追加“+参数”，
如果想要把某个隐藏功能移出文件，则需要追加“-参数”。
**chattr 命令中用于隐藏权限的参数及其作用**

参数	|	作用
--------|-----------------
i		| 无法对文件进行修改；若对目录设置了该参数，则仅能修改其中的子文件内容而不能新建或删除文件
a		| 仅允许补充（追加）内容，无法覆盖/删除内容（Append Only）
S		| 文件内容在变更后立即同步到硬盘（sync）
s		| 彻底从硬盘中删除，不可恢复（用 0 填充原文件所在硬盘区域）
A		| 不再修改这个文件或目录的最后访问时间（atime）
b		| 不再修改文件或目录的存取时间
D		| 检查压缩文件中的错误
d		| 使用 dump 命令备份时忽略本文件/目录
c		| 默认将文件或目录进行压缩
u		| 当删除该文件后依然保留其在硬盘中的数据，方便日后恢复
t		| 让文件系统支持尾部合并（tail-merging）
X		| 可以直接访问压缩文件中的内容

###### （2）lsattr 命令
用于显示文件的隐藏权限，格式为“lsattr [参数] 文件”。

##### 5、su 命令与sudo服务
###### （1）su 命令与用户名之间有一个减号（\-），这意味着完全切换到新的用户，即把环境变量信息也变更为新用户的相应信息，而不是保留原始的信息。强烈建议在切换用户身份时添加这个减号（\-）。
（注：当从 root 管理员切换到普通用户时是不需要密码验证的，而从普通用户切换成 root管理员就需要进行密码验证了；）

###### （2）sudo 命令把特定命令的执行权限赋予给指定用户
用于给普通用户提供额外的权限来完成原本 root 管理员才能完成的任务，格式为“sudo [参数] 命令名称”。
**sudo 服务中的可用参数以及作用**

参数	|	作用
--------|-----------------
-h		| 列出帮助信息
-l		| 列出当前用户可执行的命令
-u		| 用户名或 UID 值 以指定的用户身份执行命令
-k		| 清空密码的有效时间，下次执行 sudo 时需要再次进行密码验证
-b		| 在后台执行指定的命令
-p		| 更改询问密码的提示语

**总结来说，sudo 命令具有如下功能：**
* 限制用户执行指定的命令：
* 记录用户执行的每一条命令；
* 配置文件（/etc/sudoers）提供集中的用户管理、权限与主机等参数；
* 验证密码的后 5 分钟内（默认值）无须再让用户再次验证密码。

**修改sudo服务的配置文件：**
（注：只有root管理员才可以使用）
1. 使用visudo 命令打开 /etc/sudoers文件并编辑。
2. 在`root ALL=(ALL) ALL` 改行下面新增加一行，修改对应用户名称
3. 到此即可使用sudo服务，但是需要输入用户密码。免密使用可添加 NOPASSWD:ALL即可。
