---
title: Shell基础知识手册
date: 2017-12-11 10:31:18
categories:
- Shell
tags:
- Shell
---
SHELL脚本具备的内容：
（1）脚本声明（#!） 用来告诉系统使用哪种shell解释器来执行该脚本。
（2）注释信息（#）是对脚本功能和某些命令的介绍信息
（3）命令 脚本执行什么命令

## 变量
**1、变量命名**
	1. 只能使用数字、字母和下划线，且不能以数字开头
	2. 变量名区分大小写
	3. 建议命令要通俗易懂
<font color="red">**注意：**</font>

 * 变量不需要声明，初始化不需要指定类型
 * 变量赋值是通过等号（=）进行赋值，在变量、等号和值之间不能出现空格
<!--more-->

**2、变量分类**
	1. 本地变量
		* 只对当前shell进程有效的，对当前进程的子进程和其它shell进程无效。
		* 定义：VAR_NAME=VALUE
		* 变量引用：${VAR_NAME} 或者 $VAR_NAME
		* 取消变量：unset VAR_NAME
		* 相当于java中的私有变量(private)，只能当前类使用，子类和其他类都无法使用。

	2. 环境变量
		* 自定义的环境变量对当前shell进程及其子shell进程有效，对其它的shell进程无效
		* 定义：export VAR_NAME=VALUE
		* 对所有shell进程都有效需要配置到配置文件中：/etc/profile
		* 相当于java中的protected修饰符,对当前类，子孙类，以及同一个包下面可以共用。
	_（和windows中的环境变量比较类似）_

	3. 局部变量
		* 在函数中调用，函数执行结束，变量就会消失
		* 对shell脚本中某代码片段有效
		* 定义：local VAR_NAME=VALUE
		* 相当于java代码中某一个方法中定义的局部变量，只对这个方法有效。

	4. 位置变量
		比如脚本中的参数：
		    $0：脚本自身
		    $1：脚本的第一个参数
		    $2：脚本的第二个参数
		相当于java中main函数中的args参数，可以获取外部参数。

	5. 特殊变量
		$?：接收上一条命令的返回状态码
		_（返回状态码在0-255之间）_
		$#：参数个数
		$*：或者$@：所有的参数
		$$：获取当前shell的进程号（PID）(可以实现脚本自杀)(或者使用exit命令直接退出也可以使用exit [num])


## 运算符
测试语句格式： [ 条件表达式 ] （注：两边均有一个空格）
按照测试对象来划分，条件测试语句可以分为4种：
**1、文件测试语句**

运算符	|	作用
--------|---------------
-d		| 测试文件是否为目录类型
-e		| 测试文件是否存在
-f		| 判断是否为一般文件
-r		| 测试当前用户是否有权限读取
-w		| 测试当前用户是否有权限写入
-x		| 测试当前用户是否有权限执行

**2、逻辑测试语句**

运算符	| 作用
--------|--------
&&		| 逻辑与
||		| 逻辑或
！		| 逻辑非

**3、整数值比较语句**
整数比较运算符仅对数字的操作，不能将数字与字符串、文件等内容一起操作，而且不能使用日常生活中的等号、大于号、小于号来判断。
因为等号与赋值命令符冲突，大于号和小于号分别于输出重定向命令符和输入重定向命令符冲突。

运算符	|	作用
--------|------------
-eq		| 是否等于
-ne		| 是否不等于
-gt		| 是否大于
-lt		| 是否小于
-le		| 是否等于或小于
-ge		| 是否大于或等于

**4、字符串比较语句**
字符串比较语句用于判断测试字符串是否为空值，或两个字符串是否相同。

运算符	| 作用
--------|------------
=		| 比较字符串内容是否相同
!=		| 比较字符串内容是否不同
-z		| 判断字符串内容是否为空

## 运算符常用操作
**1、算术运算符**

	格式：
	let varName=算术表达式
	varName=$[算术表达式]
	varName=$((算术表达式))
	varName=\`expr $num1 + $num2\`
<font color="red">（使用这种格式要注意两个数字和+号中间要有空格。）</font>

**2、逻辑运算符**
　if [ 条件A && 条件B ] 在shell中怎么写?
　if [ 条件A && 条件B ];then    是不对的
（1）需要用到shell中的逻辑操作符
　-a 与
　-o 或
　！ 非
　如if [ 条件A -a 条件B ] 
（2）if [ 条件A ] && [条件B ]
（3）if((A&&B))
（4）if [[ A&&B ]]

## 字符串操作
![](/uploads/2017/12/shell_string_01.png)

## 数组操作
**定义：**

	declare -a：表示定义普通数组
**特点：**

	1. 支持稀疏格式
	2. 仅支持一维数组
**数组赋值方式：**

	1. 一次对一个元素赋值a[0]=$RANDOM
	2. 一次对多个元素赋值a=(a b c d)
	3. 按索引进行赋值a=([0]=a [3]=b [1]=c)

**数组操作**

	1. 使用read命令read -a ARRAY_NAME查看元素
    　${ARRAY[index]}：查看数组指定角标的元素  
    　${ARRAY}：查看数组的第一个元素  
    　${ARRAY[*]}或者${ARRAY[@]}：查看数组的所有元素  
    2. 获取数组的长度：
    　${#ARRAY[*]}  
    　${#ARRAY[@]} 
    3. 获取数组内元素的长度：
    　${#ARRAY[0]}
    4. 从数组中获取某一片段之内的元素（操作类似于字符串操作）
	　格式：    ${ARRAY[@]:offset:length}  
	　注释：
    　　offset：偏移的元素个数
    　　length：取出的元素的个数
    　　${ARRAY[@]:offset:length}：取出偏移量后的指定个数的元素
    　　${ARRAY[@]:offset}：取出数组中偏移量后的所有元素
    5. 数组删除元素：
    　unset ARRAY[index] 

## 流程控制
**if判断**

	单分支：
	 if 测试条件;then
	     选择分支
	 fi

	双分支：
	 if 测试条件
	  then
	   选择分支1
	   else
	   选择分支2
	 fi

	 多分支：
	 if 条件1; then
	           分支1
	 elif 条件2; then
	           分支2
	 elif 条件3; then
	           分支3
	          ...
	 else
	           分支n
	 fi

**Case判断**
*（有多个测试条件时，case语句会使得语法结构更清晰）*

	格式：
	case 变量引用 in
	    PATTERN1)
	        分支1
	        ;;
	    PATTERN2)
	        分支2
	        ;;
	    ...
	    *)
	        分支n
	        ;;
	esac
	注释：
	PATTERN :类同于文件名通配机制，但支持使用|表示或者
	a|b：a或者b
	*：匹配任意长度的任意字符
	?：匹配任意单个字符
	[a-z]：指定范围内的任意单个字符

## 循环控制
**for循环**
　通过使用一个变量去遍历给定列表中的每个元素，在每次变量赋值时执行一次循环体，直至赋值完成所有元素退出循环
*（注意：for i in {0..9} 等于for i in {0..9..1} , 第三个参数为跨步。）*

	格式1：
	for ((i=0;i<10;i++))
	do
	  ...
	Done
	格式2：
	for i in 0 1 2 3 4 5 6 7 8 9
	do
	...
	Done
	格式3：
	for i in {0..9}
	do
	  ...
	done

**while循环**
　适用于循环次数未知，或不便用for直接生成较大的列表时

	格式：
	while 测试条件
	do
	循环体
	done

**循环控制命令**

	循环控制命令——break
	break命令是在处理过程中跳出循环的一种简单方法，可以使用break命令退出任何类型的循环，包括while循环和for循环

	循环控制命令——continue
	continue命令是一种提前停止循环内命令，而不完全终止循环的方法，这就需要在循环内设置shell不执行命令的条件

**条件**
　bash条件测试

	格式：
	    test EXPR
	    [ EXPR ]：注意中括号和表达式之间的空格

	整型测试：
	    -gt：大于：
	    -lt：小于
	    -ge：大于等于
	    -le：小于等于
	    -eq：等于
	    -ne：不等于
	例如[ $num1 -gt $num2 ]或者test $num1 -gt $num2

	字符串测试：
	    =：等于，例如判断变量是否为空 [ "$str" =  "" ] 或者[ -z $str ]
	    !=：不等于

## 函数

	格式：
	function 函数名(){
	...
	}

	1. 引用自定义函数文件时，使用source  func.sh
	2. 有利于代码的重用性
	3. 函数传递参数（可以使用类似于Java中的args，args[1]代表Shell中的$1）
	4. 函数的返回值，只能是数字
	5. 函数的调用： 函数名
	
## 特殊
shell中执行命令：
\`命令\`
\$(命令)

shell脚本中 整数运算一般通过let和expr这两个指令来实现。
如： `let "s = $s + 1"` 或者 `s=\`expr $s + 1\``
（注：let的性能远超expr的。建议使用let）
常用于：
自加/自减操作：`let no++` 、`let no--` 、`let no += 20`
