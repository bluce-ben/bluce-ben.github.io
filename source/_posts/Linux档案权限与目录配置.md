---
title: Linux 档案权限与目录配置
date: 2018-01-22 16:01:07
categories:
- 书籍
- 《鸟哥的Linux私房菜基础篇（第三版）》
tags:
- 书籍
- Linux
---
Linux最优秀的地方之一，就在于他的多人多任务环境。而为了让各个使用者具有较保密的档案数据，因此档案的权限管理就变的很重要了。Linux一般将档案可存取的身份分为三个类别，分别是owner/group/others，且三种身份各有read/write/execute等权限
<!--more-->
#### 1、身份类别
* 档案拥有者User
* 群组概念Group
* 其他人Others
* root

对应记录数据的档案：
* 各种身份的相关信息：/etc/passwd
* 个人的密码：/etc/shadow
* 组名:/etc/group

#### 2、权限的意义
##### （1）对档案
>r：可读取此档案的实际内容
w：可编辑，新增或者修改此档案的内容（但不含删除该档案）
x：该档案具有可以被系统执行的权限（Windows底下一个档案是否具有执行的能力是藉由【扩展名】来判断的，例如：.exe, .bat, .com等等，但是在Linux底下，我们的档案是否能被执行，则是藉由是否具有【x】这个权限来决定的）

##### （2）对目录
>r：可读取目录结构列表，可查询该目录下的文件名数据，ls命令可显示它们
w：可新建目录与档案，可删除已存在的目录与档案，可更改他们的名字，可移动它们的位置
x：用户能进入该目录成为工作目录，cd命令可进入它，如果没有x权限，不能执行它下面的任何指令
（注：对目录的 w 权限要谨慎给予！）

案例：账户为dmtai的家目录为/home/dmtai，账户dmtai对这个目录有rwx的权限。此目录下有一个档案叫the_root.data，它的权限为：
`-rwx------ 1 root root 4356 Sep 19 20:20 the_root.data`
分析：档案对于账户dmtai来说属于others身份，所以这个档案，dmtai无法读取，无法编辑也无法执行。但是dmtai对目录dmtai具有rwx的权限，也就是说dmtai账户可以删除这个档案！！


#### 3、Linux文件属性
```
ls -al
-rw-r--r--    1           root   root     42304        Sep 4 18:26     install.log
[档案类型][档案类型权限][连接数][User][Group][档案容量bytes][档案最后修改时间][档案名]
```
各栏详解如下：
>（1）第一栏表示档案类型权限：总共10个字符，
第一个字符代表这个档案类型：
　　① 正规档案[-]：纯文本档（ASCII），二进制文件（binary），数据格式文件（data）
　　② 目录[d]
　　③ 连结档[l]
　　④ 设备与装置文件
　　　　1）区块设备档[b]：可随机存取装置（比如硬盘，软盘）
　　　　2）字符设备文件[c]：一次性读取装置（比如键盘，鼠标）
　　⑤ 资料接口文件（sockets）[s]：称为数据接口文件
　　⑥ 数据输送文件（FIFO,pipe）[p]：特殊的文件类型
接下来9个字符3个一组，三组权限分别对应为：User，Group，Others
（2）第二栏表示有多少档名连结到此节点(i-node)：
每个档案都会将他的权限与属性记录到文件系统的 i-node 中，不过，我们使用的目录树却是使用文件名来记录，因此每个档名就会连结到一个 i-node ！这个属性记录的，就是有多少不同的档名连结到相同的一个 i-node 号码就是了。
（3）第三栏表示这个档案(或目录)的【拥有者账号】
（4）第四栏表示这个档案的所属群组
（5）第五栏为这个档案的容量大小，默认单位为bytes；
（6）第六栏为这个档案的建档日期或者是最近的修改日期：
（7）第七栏为这个档案的档名


#### 4、如何改变文件属性与权限
##### （1）chgrp：改变档案所属群组
基本语法：chgrp [-R] groupname filename
选项与参数：
    -R：进行递归的持续变更，即目录下的所有档案，目录都更新为属于这个新群组
示例：
chgrp users install.log #users这个群组必须存在于/etc/group记录的群组里

##### （2）chown：改变档案拥有者
基本语法：chown [-R] ownername[:groupname] filename
选项与参数：
    -R：进行递归的持续变更，即目录下的所有档案，目录都更新为属于这个新拥有者
示例：
chown bin install.log #bin这个拥有者必须存在于/etc/passwd记录的拥有者里
#应用：cp 源档案 目标档案后，新的使用者可能无法使用copy后的档案，这时就需要赋予新档案一个新的拥有者和新的群组了。

##### （3）chmod：改变档案的权限，SUID，SGID，SBIT等特性
>**数字类型改变档案权限**
各权限的分数如下：r:4 w:2 x:1
每种身份各自的权限都是以上3个相加得到。如7=4+2+1,5=4+0+1（不可能是5=2+2+1哦，因为第一个肯定是r，数值要不是4要不是0，不能是2）
基本语法：chmod [-R] xyz 档案或目录
选项与参数：
　　xyz : 就是刚刚提到的数字类型的权限属性，为 rwx 属性数值的相加。
　　-R : 进行递归(recursive)的持续变更，亦即连同次目录下的所有档案都会变更
示例：
chmod 770 .bashrc

>**符号类型改变档案权限**
![](/uploads/2018/01/linux_permission.JPG)
基本语法：chmod ugoa +-= rwx 档案或目录  #a代表all即全部的身份
示例：
chmod u=rwx,go=rx .bashrc   #u=rwx,go=rx是连在一起的，中间没有任何空格符


#### 5、Linux 目录配置
##### （1）目录配置依据：FHS（Filesystem Hierarchy Standard）
亊实上，FHS 是根据过去的经验一直再持续的改版的，FHS 依据文件系统使用的频繁与否与是否允许使用者随意更动，而将目录定义成为四种交互作用的形态，用表格来说有点像底下这样：
![](/uploads/2018/01/linux_directory_fhs.JPG)

上表中的目录就是一些代表性的目录，该目录底下所放置的数据在底下会谈到，这里先略过不谈。我们要了解的是，什么是那四个类型？
* 可分享的：可以分享给其他系统挂载使用的目录，所以包括执行文件与用户的邮件等数据，是能够分享给网络上其他主机挂载用的目录；
* 不可分享的：自己机器上面运作的装置档案或者是与程序有关的 socket 档案等，由于仅与自身机器有关，所以当然就不适合分享给其他主机了。
* 不变的：有些数据是不会经常变动的，跟随着 distribution 而不变动。例如函式库、文件说明文件、系统管理员所管理的主机服务配置文件等等；
* 可变动的：经常改变的数据，例如登录文件、一般用户可自行收受的新闻组等。

亊实上，FHS 针对目录树架构仅定义出三层目录底下应该放置什么数据而已，分别是底下这三个目录的定义：
* / (root, 根目录)：与开机系统有关；
* /usr (unix software resource)：与软件安装/执行有关；
* /var (variable)：与系统运作过程有关。


##### （2）根目录 (/) 的意义与内容：
根目录是整个系统最重要的一个目录，因为不但所有的目录都是由根目录衍生出来的，同时根目录也与开机/还原/系统修复等动作有关。由于系统开机时需要特定的开机软件、核心档案、开机所需程序、函式库等等档案数据，若系统出现错误时，根目录也必项要包含有能够修复文件系统的程序才行。因为根目录是这么的重要，所以在 FHS 的要求方面，他希服根目录不要放在非常大的分割槽内，因为越大的分割槽你会放入越多的数据，如此一来根目录所在分割槽就可能会有较多发生错误的机会。

因此 FHS 标准建议：根目录(/)所在分割槽应该越小越好，且应用程序所安装的软件最好不要与根目录放在同一个分割槽内，保持根目录越小越好。如此不但效能较佳，根目录所在的文件系统也较不容易发生问题。

有鉴于上述的说明，因此 FHS 定义出根目录(/)底下应该要有底下这些次目录的存在才好：
![](/uploads/2018/01/linux_directory_root.JPG)

另外要注意的是，因为根目录与开机有关，开机过程中仅有根目录会被挂载，其他分割槽则是在开机完成之后才会持续的进行挂载的行为。就是因为如此，因此根目录下与开机过程有关的目录，就不能够与根目录放到不同的分割槽去！那哪些目录不可与根目录分开呢？有底下这些：
* /etc：配置文件
* /bin：重要执行档
* /dev：所需要的装置档案
* /lib：执行档所需的函式库不核心所需的模块
* /sbin：重要的系统执行文件


##### （3）/usr 的意义与内容：
依据FHS 的基本定义，/usr 里面放置的数据属于可分享的与不可变动的(shareable, static)，如果你知道如何透过网络进行分割槽的挂载，那么 /usr 确实可以分享给局域网络内的其他主机来使用！

很多读者都会误会 /usr 为 user 的缩写，其实 usr 是 Unix Software Resource 的缩写，也就是【Unix 操作系统软件资源】所放置的目录，而不是用户的数据！这点要注意。FHS 建议所有软件开发者，应该将他们的数据合理的分别放置到这个目录下的次目录，而不要自行建立该软件自己独立的目录。

因为是所有系统默认的软件(distribution 发布者提供的软件)都会放置到 /usr 底下，因此这个目录有点类似 Windows 系统的【C:\Windows\ + C:\Program files\】这两个目录的综合体，系统刚安装完毕时，这个目录会占用最多的硬盘容量。一般来说，/usr 的次目录建议有底下这些：
![](/uploads/2018/01/linux_directory_usr.jpg)

（4）/var 的意义与内容：
如果 /usr 是安装时会占用较大硬盘容量的目录，那么 /var 就是在系统运作后才会渐渐占用硬盘容量的目录。因为 /var 目录主要针对常态性变动的档案，包括快取(cache)、登录档(log file)以及某些软件运作所产生的档案，包括程序档案(lock file, run file)，或者例如 MySQL 数据库的档案等等。常见的次目录有：
![](/uploads/2018/01/linux_directory_var.JPG)